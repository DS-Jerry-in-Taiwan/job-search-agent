

### **æª”æ¡ˆï¼š01_dev_goal_context.md**

ä»¥ä¸‹æ˜¯å®Œæ•´å…§å®¹ï¼Œè«‹è¤‡è£½è²¼å…¥ï¼š

```markdown
# Phase 3 - State å®šç¾©é–‹ç™¼ç›®æ¨™

**éšæ®µ**: Day 1 æ­¥é©Ÿ2 - State Schema Design  
**ç›®çš„**: å®šç¾© job_search_agent çš„æ ¸å¿ƒç‹€æ…‹çµæ§‹  
**å„ªå…ˆç´š**: ğŸ”´ Criticalï¼ˆå½±éŸ¿æ‰€æœ‰å¾ŒçºŒé–‹ç™¼ï¼‰

---

## ğŸ¯ é–‹ç™¼ç›®æ¨™

è¨­è¨ˆä¸¦å¯¦ç¾ job_search_agent çš„å®Œæ•´ State Schemaï¼Œä½œç‚ºæ•´å€‹ Multi-Agent ç³»çµ±çš„æ•¸æ“šåŸºç¤ã€‚

### **æ ¸å¿ƒç›®æ¨™**

1. **å®šç¾© 4 å¤§æ ¸å¿ƒ State**
   - User Profile Stateï¼ˆç”¨æˆ¶ç‹€æ…‹ï¼‰
   - Job Stateï¼ˆè·ç¼ºç‹€æ…‹ï¼‰
   - Conversation Stateï¼ˆå°è©±ç‹€æ…‹ï¼‰
   - System Stateï¼ˆç³»çµ±ç‹€æ…‹ï¼‰

2. **å»ºç«‹ State è½‰ç§»è¦å‰‡**
   - å®šç¾© State ä¹‹é–“çš„ä¾è³´é—œä¿‚
   - è¨­è¨ˆ State æ›´æ–°æ©Ÿåˆ¶
   - ç¢ºä¿ State ä¸€è‡´æ€§

3. **è¨­è¨ˆ TypedDict çµæ§‹**
   - ç¬¦åˆ LangGraph è¦ç¯„
   - æ”¯æ´é¡å‹æª¢æŸ¥
   - ä¾¿æ–¼åºåˆ—åŒ–èˆ‡æŒä¹…åŒ–

---

## ğŸ“Š State Schema çµæ§‹

### **1. User Profile State**

**ç”¨é€”**: å„²å­˜ç”¨æˆ¶å±¥æ­·è³‡è¨Šèˆ‡åå¥½è¨­å®š

**å¿…è¦æ¬„ä½**:
```
class UserProfileState(TypedDict):
    user_id: str                          # ç”¨æˆ¶å”¯ä¸€è­˜åˆ¥ç¢¼
    resume_text: str                      # å±¥æ­·åŸå§‹æ–‡æœ¬
    skills: List[str]                     # æŠ€èƒ½æ¸…å–®
    experience_years: int                 # å·¥ä½œå¹´è³‡
    education: str                        # å­¸æ­·
    preferences: Dict[str, Any]           # åå¥½è¨­å®š
    parsed_at: datetime                   # è§£ææ™‚é–“
```

**è¨­è¨ˆè€ƒé‡**:
- âœ… æ”¯æ´å¾ PDF è§£æçš„å±¥æ­·è³‡è¨Š
- âœ… é ç•™æ“´å±•æ¬„ä½ï¼ˆpreferencesï¼‰
- âœ… è¨˜éŒ„è§£ææ™‚é–“ä»¥ä¾¿è¿½è¹¤

---

### **2. Job State**

**ç”¨é€”**: å„²å­˜è·ç¼ºè³‡è¨Šèˆ‡åŒ¹é…çµæœ

**å¿…è¦æ¬„ä½**:
```
class JobState(TypedDict):
    jobs: List[Dict[str, Any]]            # è·ç¼ºæ¸…å–®
    matched_jobs: List[Dict[str, Any]]    # åŒ¹é…çš„è·ç¼º
    match_scores: Dict[str, float]        # åŒ¹é…åº¦åˆ†æ•¸
    recommendations: List[str]            # æ¨è–¦ç†ç”±
    last_updated: datetime                # æœ€å¾Œæ›´æ–°æ™‚é–“
```

**è¨­è¨ˆè€ƒé‡**:
- âœ… å€åˆ†å…¨éƒ¨è·ç¼ºèˆ‡åŒ¹é…è·ç¼º
- âœ… å„²å­˜åŒ¹é…åº¦è¨ˆç®—çµæœ
- âœ… è¨˜éŒ„æ¨è–¦ç†ç”±ä»¥ä¾›è§£é‡‹

---

### **3. Conversation State**

**ç”¨é€”**: å„²å­˜å°è©±æ­·å²èˆ‡ä¸Šä¸‹æ–‡

**å¿…è¦æ¬„ä½**:
```
class ConversationState(TypedDict):
    messages: List[BaseMessage]           # å°è©±è¨Šæ¯åˆ—è¡¨
    current_intent: str                   # ç•¶å‰æ„åœ–
    context: Dict[str, Any]               # å°è©±ä¸Šä¸‹æ–‡
    history_summary: str                  # æ­·å²æ‘˜è¦
    turn_count: int                       # å°è©±è¼ªæ¬¡
```

**è¨­è¨ˆè€ƒé‡**:
- âœ… ä½¿ç”¨ LangChain BaseMessage æ¨™æº–æ ¼å¼
- âœ… è¨˜éŒ„ç•¶å‰æ„åœ–ä»¥ä¾¿è·¯ç”±
- âœ… æ”¯æ´æ­·å²æ‘˜è¦ä»¥ç¯€çœ token

---

### **4. System State**

**ç”¨é€”**: å„²å­˜ç³»çµ±åŸ·è¡Œç‹€æ…‹èˆ‡æµç¨‹æ§åˆ¶

**å¿…è¦æ¬„ä½**:
```
class SystemState(TypedDict):
    current_node: str                     # ç•¶å‰åŸ·è¡Œç¯€é»
    workflow_status: str                  # å·¥ä½œæµç¨‹ç‹€æ…‹
    error_message: Optional[str]          # éŒ¯èª¤è¨Šæ¯
    retry_count: int                      # é‡è©¦æ¬¡æ•¸
    metadata: Dict[str, Any]              # å…ƒæ•¸æ“š
```

**è¨­è¨ˆè€ƒé‡**:
- âœ… è¿½è¹¤åŸ·è¡Œæµç¨‹
- âœ… æ”¯æ´éŒ¯èª¤è™•ç†
- âœ… è¨˜éŒ„é‡è©¦æ¬¡æ•¸é¿å…ç„¡é™å¾ªç’°

---

### **5. æ•´åˆ State (AgentState)**

**å®Œæ•´çš„ Agent State çµæ§‹**:

```
class AgentState(TypedDict):
    # User Profile
    user_profile: UserProfileState
    
    # Job Management
    job_state: JobState
    
    # Conversation
    conversation: ConversationState
    
    # System
    system: SystemState
    
    # Shared
    next_action: str                      # ä¸‹ä¸€æ­¥å‹•ä½œ
    is_complete: bool                     # æ˜¯å¦å®Œæˆ
```

---

## ğŸ“‹ é©—æ”¶æ¨™æº–

### **åŠŸèƒ½é©—æ”¶**

- [ ] æ‰€æœ‰ 4 å¤§ State å®šç¾©å®Œæ•´
- [ ] TypedDict é¡å‹å®šç¾©æ­£ç¢º
- [ ] æ”¯æ´åºåˆ—åŒ–èˆ‡ååºåˆ—åŒ–
- [ ] é€šé mypy é¡å‹æª¢æŸ¥
- [ ] åŒ…å«å®Œæ•´çš„æ¬„ä½è¨»è§£

### **å“è³ªé©—æ”¶**

- [ ] æ¬„ä½å‘½åæ¸…æ™°ä¸€è‡´
- [ ] å¿…è¦æ¬„ä½èˆ‡å¯é¸æ¬„ä½æ˜ç¢ºå€åˆ†
- [ ] é ç•™æ“´å±•ç©ºé–“
- [ ] ç¬¦åˆ LangGraph è¦ç¯„
- [ ] æ–‡æª”å®Œæ•´

### **æ¸¬è©¦é©—æ”¶**

- [ ] å»ºç«‹æ¸¬è©¦æ¡ˆä¾‹é©—è­‰ State åˆå§‹åŒ–
- [ ] æ¸¬è©¦ State æ›´æ–°æ©Ÿåˆ¶
- [ ] æ¸¬è©¦ State åºåˆ—åŒ–
- [ ] æ¸¬è©¦æ¬„ä½é¡å‹æª¢æŸ¥

---

## ğŸ“ é æœŸç”¢å‡ºç‰©

### **æ ¸å¿ƒæª”æ¡ˆ**

1. **src/state/schema.py**
   - å®šç¾©æ‰€æœ‰ State TypedDict
   - åŒ…å«é¡å‹è¨»è§£èˆ‡æ–‡æª”

2. **src/state/operations.py**
   - State åˆå§‹åŒ–å‡½æ•¸
   - State æ›´æ–°å‡½æ•¸
   - State é©—è­‰å‡½æ•¸

3. **tests/test_state_schema.py**
   - State åˆå§‹åŒ–æ¸¬è©¦
   - State æ›´æ–°æ¸¬è©¦
   - é¡å‹æª¢æŸ¥æ¸¬è©¦

### **æ–‡æª”æª”æ¡ˆ**

4. **docs/state_design.md**
   - State Schema è¨­è¨ˆèªªæ˜
   - æ¬„ä½å®šç¾©æ–‡æª”
   - ä½¿ç”¨ç¯„ä¾‹

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

### **å®Œæˆåº¦æŒ‡æ¨™**

- âœ… 4 å¤§ State å…¨éƒ¨å®šç¾©å®Œæˆ
- âœ… é€šéæ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹
- âœ… é¡å‹æª¢æŸ¥ 100% é€šé
- âœ… æ–‡æª”å®Œæ•´åº¦ 100%

### **å“è³ªæŒ‡æ¨™**

- âœ… ç¨‹å¼ç¢¼å¯è®€æ€§ A ç´š
- âœ… å‹åˆ¥å®‰å…¨æ€§ 100%
- âœ… æ“´å±•æ€§è©•ä¼°é€šé
- âœ… åœ˜éšŠ Code Review é€šé

---

## ğŸ”— ç›¸é—œæ–‡ä»¶

- åƒè€ƒï¼šPhase 2 ç”¢å‡ºçš„ `data/mock/data_schema.json`
- åƒè€ƒï¼šLangGraph State Management æ–‡æª”
- åƒè€ƒï¼šTypedDict å®˜æ–¹æ–‡æª”

---

## âš ï¸ æ³¨æ„äº‹é …

1. **ä¸è¦éåº¦è¨­è¨ˆ**
   - åªå®šç¾©ç•¶å‰ MVP éœ€è¦çš„æ¬„ä½
   - é ç•™æ“´å±•ç©ºé–“ä½†ä¸é å…ˆå¯¦ç¾

2. **ä¿æŒä¸€è‡´æ€§**
   - å‘½åé¢¨æ ¼çµ±ä¸€ï¼ˆsnake_caseï¼‰
   - é¡å‹è¨»è§£çµ±ä¸€ï¼ˆæ˜ç¢ºæŒ‡å®šé¡å‹ï¼‰

3. **è€ƒæ…®æ•ˆèƒ½**
   - é¿å…å·¢ç‹€éæ·±çš„çµæ§‹
   - è€ƒæ…®åºåˆ—åŒ–æ•ˆèƒ½

4. **æ–‡æª”å„ªå…ˆ**
   - æ¯å€‹æ¬„ä½éƒ½è¦æœ‰æ¸…æ¥šçš„è¨»è§£
   - æä¾›ä½¿ç”¨ç¯„ä¾‹

---

**Phase 3 çš„æˆåŠŸå°‡ç›´æ¥æ±ºå®šå¾ŒçºŒæ‰€æœ‰ Agent çš„é–‹ç™¼å“è³ªï¼** ğŸ¯
```

